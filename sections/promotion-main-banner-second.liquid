{%- assign product_count = 0 -%}

{%- for block in section.blocks -%}
	{%- case block.type -%}
        {%- when 'product' -%}
            {%- assign product_count = product_count | plus: 1 -%}
    {%- endcase -%}
{%- endfor -%}


<link rel="stylesheet" href="{{ 'homepage_promo_second.css' | asset_url }}">

<!-- -- main banner start -- -->
<div class="bf_sale-banners">
    <div class="main_banner">
        <div class="container-fluid">
            <div class="event_content-main">
                <div class="row">
                    <div class="col-lg-5 px-0">
                        <div class="banner_img"{% if section.settings.link_url != blank %} onclick="location.href='{{ section.settings.link_url }}';" style="cursor: pointer"{% endif %}>
                            {% if section.settings.image %}
                                <img src="{{ section.settings.image | img_url: 'master' }}" class="w-100 d-md-block d-none" alt="desktop banner">
                            {% endif %}
                            {% if section.settings.image_mobile %}
                                <img src="{{ section.settings.image_mobile | img_url: '720x' }}" class="w-100 d-md-none" alt="mobile banner">
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-lg-7">
                        <div class="event_pd-content">
                            <div class="banner_bf-text">
                                {% if section.settings.heading != blank %}
                                    <h1 class="mb-0">{{ section.settings.heading }}</h1>
                                {% endif %}

                                {% if section.settings.subheading != blank %}
                                    <h5>
                                        {{ section.settings.subheading 
                                        |  replace: '<p>', '' |  replace: '</p>', '' 
                                        |  replace: '<em>', '<span class="red-line">' |  replace: '</em>', '</span>' 
                                        }}
                                    </h5>
                                {% endif %}

                                {%- for block in section.blocks -%}
                                    {% if block.type == 'link' %}
                                        <a href="{{ block.settings.link_url }}" class="btn_black btn" aria-label="{{ block.settings.link_label | escape }}">{{ block.settings.link_label }}</a>
                                    {% endif %}
                                {%- endfor -%}
                            </div>

                            {% if product_count > 0 %}
                                <div class="bf_sale-slider">
                                    <div class="swiper newCycleSlider dot_pagination">
                                        <div class="swiper-wrapper">
                                            {%- for block in section.blocks -%}
                                                {% if block.type == 'product' %}
                                                    <div class="swiper-slide"{% if block.settings.product_url != blank %} onclick="location.href='{{ block.settings.product_url }}';"{% endif %}>
                                                        <div class="new-slide">
                                                            {% if block.settings.image != blank %}
                                                                <div class="new_img">
                                                                    <img src="{{ block.settings.image | img_url: '540x' }}" alt="{{ block.settings.image.alt | escape }}" class="img-fluid" />
                                                                </div>
                                                            {% endif %}
                                                            <div class="new_content">
                                                                {% if block.settings.text != blank %}
                                                                    <span>{{ block.settings.text }}</span>
                                                                {% endif %}
                                                                <h4 class="new-header"><span>{{ block.settings.heading }}</span>{{ block.settings.subheading }}</h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <div class="swiper-pagination d-block d-lg-none"></div>
                                    </div>
                                    <div class="new-arrow swiper-button-prev swiper-button"></div>
                                    <div class="new-arrow  swiper-button-next swiper-button"></div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- -- main banner end -- -->

{% if product_count > 0 %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var swiper = new Swiper(".newCycleSlider", {
                slidesPerView: 2,
                spaceBetween: 10,
                grabCursor: true,
                navigation: {
                    nextEl: ".swiper-button-next",
                    prevEl: ".swiper-button-prev",
                },
                pagination: {
                    el: ".swiper-pagination",
                    clickable: true,
                },
                breakpoints: {
                    320: {
                        slidesPerView: 1,
                    },
                    480: {
                        slidesPerView: 1,
                    },
                    640: {
                        slidesPerView: 2,
                    }
                }
            });
        });
    </script>    
{% endif %}

{% schema %}
    {
        "name": "t:sections.main-banner-promotion-second.name",
        "class": "section-main-banner-promotion-second",
        "settings": [
            {
                "type": "text",
                "id": "heading",
                "label": "t:common.heading.label"
            },
            {
                "type": "text",
                "id": "heading_mobile",
                "label": "t:common.heading.mobile.label"
            },
            {
                "type": "richtext",
                "id": "subheading",
                "label": "t:common.subheading.label"
            },
            {
                "type": "richtext",
                "id": "subheading_mobile",
                "label": "t:common.subheading.mobile.label"
            },
            {
                "type": "richtext",
                "id": "text",
                "label": "t:common.text.label"
            },
            {
                "type": "image_picker",
                "id": "image",
                "label": "t:common.image.label"
            },
            {
                "type": "image_picker",
                "id": "image_mobile",
                "label": "t:common.image_mobile.label"
            },
            {
                "type": "url",
                "id": "link_url",
                "label": "t:common.link.url.label"
            }
        ],
        "blocks": [
            {
                "type": "product",
                "name": "t:common.product.label",
                "limit": 10,
                "settings": [
                    {
                        "type": "text",
                        "id": "heading",
                        "label": "t:common.heading.label"
                    },
                    {
                        "type": "text",
                        "id": "subheading",
                        "label": "t:common.subheading.label"
                    },
                    {
                        "type": "text",
                        "id": "text",
                        "label": "t:common.text.label"
                    },
                    {
                        "type": "image_picker",
                        "id": "image",
                        "label": "t:common.image.label"
                    },
                    {
                        "type": "url",
                        "id": "product_url",
                        "label": "t:common.product.url.label"
                    }
                ]
		    },
            {
                "type": "link",
                "name": "t:sections.main-banner-promotion.blocks.link.name",
                "limit": 1,
                "settings": [
                    {
                        "type": "text",
                        "id": "link_label",
                        "default": "Link label",
                        "label": "t:common.link.label",
                        "info": "t:common.link.info"
                    },
                    {
                        "type": "text",
                        "id": "link_label_mobile",
                        "default": "Link label mobile",
                        "label": "t:common.link.mobile.label",
                        "info": "t:common.link.info"
                    },
                    {
                        "type": "url",
                        "id": "link_url",
                        "label": "t:common.link.url.label"
                    }
                ]
            }
        ],
        "presets": [
			{
				"name": "t:sections.main-banner-promotion-second.name"
			}
        ]
    }
{% endschema %}