{% liquid
  assign meta_data = page.metafields.custom.upsell_popup.value

  assign check_icon = ''
  capture check_icon
    render 'pdm_landing-purchase-icons', icon: 'check-value'
  endcapture
%}

<div id="popupUpsell" class="popupsell-main">
  <div class="popupsell-wrapper">
    <div class="popupsell-close-wrapper">
       <div class="popupsell-close" id="closePopupUpsell">
         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
           <path d="M17.913 5.0295L12 10.9425L6.08702 5.0295C5.9448 4.89936 5.75785 4.82911 5.56513 4.83338C5.3724 4.83765 5.18875 4.91611 5.05244 5.05242C4.91613 5.18873 4.83766 5.37238 4.83339 5.56511C4.82912 5.75784 4.89937 5.94478 5.02952 6.087L10.9395 12L5.02802 17.9115C4.95579 17.9803 4.89806 18.0629 4.85821 18.1544C4.81836 18.2458 4.79719 18.3443 4.79596 18.4441C4.79472 18.5438 4.81344 18.6428 4.85101 18.7353C4.88859 18.8277 4.94426 18.9116 5.01475 18.9822C5.08525 19.0528 5.16914 19.1086 5.26151 19.1463C5.35388 19.184 5.45285 19.2029 5.55261 19.2018C5.65237 19.2007 5.7509 19.1797 5.84242 19.14C5.93393 19.1002 6.01659 19.0426 6.08552 18.9705L12 13.059L17.913 18.972C18.0552 19.1021 18.2422 19.1724 18.4349 19.1681C18.6276 19.1639 18.8113 19.0854 18.9476 18.9491C19.0839 18.8128 19.1624 18.6291 19.1666 18.4364C19.1709 18.2437 19.1007 18.0567 18.9705 17.9145L13.0575 12.0015L18.9705 6.087C19.0427 6.01817 19.1005 5.9356 19.1403 5.84414C19.1802 5.75268 19.2013 5.65418 19.2026 5.55442C19.2038 5.45466 19.1851 5.35566 19.1475 5.26324C19.1099 5.17083 19.0543 5.08685 18.9838 5.01626C18.9133 4.94566 18.8294 4.88987 18.737 4.85217C18.6447 4.81446 18.5457 4.7956 18.4459 4.79669C18.3462 4.79779 18.2476 4.81882 18.1561 4.85854C18.0646 4.89826 17.9819 4.95588 17.913 5.028V5.0295Z" fill="#797D7C"/>
         </svg>
       </div>
     </div>
    {% for data in meta_data %}
      {% liquid
        assign data_product = data.item.value
        assign data_product_price = data_product.price | divided_by: 100.0
        assign monthly_price = data_product.price | divided_by: 100.0 | divided_by: 3.0 | ceil | times: 100
        assign difference_price = data_product.price | minus: monthly_price
        assign percentage_difference = difference_price | divided_by: data_product_price | floor
      %}
      <div class="popupsell-card" data-product-id="{{ data_product.id }}">
        {% comment %} title {% endcomment %}
        <div class="popupsell-card-title">
          <p>{{ data.upsell_subtitle }}</p>
          <h2>{{ data.upsell_title }}</h2>
        </div>

        {% comment %} product {% endcomment %}
        <div class="popupsell-card-content">
          <div class="popupsell-card-content-product">
            <div class="popupsell-card-content-product-image">
              {{ data_product.featured_image | image_url: width: 300 | image_tag: alt: data_product.title }}
            </div>
            <div class="popupsell-card-content-product-info">
              <div class="popupsell-card-content-product-info-wrapper">
                <h3>{{ data.upsell_product_title }}</h3>
                <div class="popupsell-card-content-product-info-price">
                  <div class="popupsell-card-content-product-info-price-amount">
                    <span class="popupsell-card-content-product-info-price-amount__full">
                      {{- data_product.price | money_without_trailing_zeros -}}
                    </span>
                    <span class="popupsell-card-content-product-info-price-amount__discount">
                      {{ monthly_price | money_without_trailing_zeros }}
                    </span>
                  </div>

                  <div class="popupsell-card-content-product-info-price-offer">
                    <p>save {{ difference_price | money_without_trailing_zeros }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% comment %} value props {% endcomment %}

          <div class="popupsell-card-content-valueprops">
            <div class="popupsell-card-content-valueprops-info">
              <p>{{ data.upsell_valueprops_title }}</p>
              {{ data.upsell_valueprops_content | metafield_tag | replace: '(check)', check_icon }}
            </div>
            <div class="popupsell-card-content-valueprops-footer">
              <p>{{ data.upsell_valueprops_footer }}</p>
            </div>
          </div>
        </div>

        {% comment %} buttons  {% endcomment %}
        <div class="popupsell-card-buttons">
          <button
            class="popupUpsellButtons"
            data-product-id="{{ data_product.variants.first.id }}"
          >
            <p>
            {{ data.upsell_text_button_1 }} {{ percentage_difference }}%
            </p>
          </button>
          <button
            class="popupUpsellNoThanks"
          >
            <p>{{ data.upsell_text_button_2 }}</p>
          </button>
        </div>
      </div>
    {% endfor %}
  </div>
</div>


